<div class="container">
  @if (viewMode() === 'tree') {
    <div class="tree-container">
      <p-tree
        [value]="categories()"
        [lazy]="true"
        (onNodeExpand)="loadNode($event)"
        selectionMode="single"
      >
        <ng-template let-node pTemplate="default">
          <div class="node-content" [attr.aria-expanded]="node.expanded ? 'true' : 'false'" role="treeitem">
            <span class="node-label">
              @if (node.children && node.children.length) {
                <i class="pi" [ngClass]="node.expanded ? 'pi-chevron-up' : 'pi-chevron-down'" (click)="toggleNode(node)" aria-label="باز و بسته کردن زیرمجموعه‌ها"></i>
              }
              {{ node.label }}
            </span>
            <div class="node-actions">
              <button
                pButton
                type="button"
                icon="pi pi-list"
                class="show-attributes-btn"
                (click)="showAttributesDialog(node)"
                title="نمایش ویژگی‌ها"
                [disabled]="!node.data?.id"
                aria-label="نمایش ویژگی‌های دسته‌بندی"
              ></button>
            </div>
          </div>
        </ng-template>
      </p-tree>
    </div>
  } @else {
    <div class="attributes-container">
      <div class="header">
        <button (click)="goBack()" class="back-btn" aria-label="بازگشت به درخت دسته‌بندی">
          <i class="pi pi-arrow-right"></i>
        </button>
        <h2>ویژگی‌های {{ selectedNode()?.label }}</h2>
      </div>
      @if (isLoadingAttributes()) {
        <p-progressSpinner aria-label="در حال بارگذاری ویژگی‌ها"></p-progressSpinner>
      } @else {
        @if (selectedNode()?.data.attributes?.length) {
          @for (attr of selectedNode()?.data.attributes; track trackByAttribute($index, attr)) {
            <div class="attribute-item">
              {{ attr.attributeName }} ({{ attr.attributeType }})
              @if (attr.inherited) {
                <span class="inherited"> (ارث‌بری‌شده) </span>
              }
              @if (attr.required) {
                <span class="required"> (اجباری) </span>
              }
            </div>
          }
        } @else {
          <div class="no-attributes">هیچ ویژگی‌ای وجود ندارد</div>
        }
      }
    </div>
  }
</div>