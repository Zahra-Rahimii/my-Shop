<!-- <h2>لیست کالاها</h2>
<div class="grid">
  @for (item of listings(); track item.id; let idx = $index) {
  <div class="col-12 md:col-6 lg:col-4">
    <p-card [header]="item.title" class="mb-3 shadow-2">
      <ng-template pTemplate="content">
        <div class="flex flex-column gap-2">
          <span><strong>قیمت:</strong> {{ item.price | number }} تومان</span>
          <br>
          <span>
            <strong>وضعیت:</strong>
            <p-tag
              [value]="(item.stock && item.stock > 0) ? 'نو' : 'دست دوم'"
              [severity]="(item.stock && item.stock > 0) ? 'success' : 'warning'"
            ></p-tag>
          </span>
          <br>
          @if (item.description) {
          <span>
            <strong>توضیحات:</strong> {{ item.description }}
          </span>
          }
          @for (attr of item.attributeValues; track attr.attributeName) {
          <div>
            <strong>{{ attr.attributeName }}:</strong> {{ attr.value }}
          </div>
          }
        </div>
      </ng-template>
      <ng-template pTemplate="footer">
        <button pButton type="button" label="حذف" class="p-button-danger" (click)="deleteProduct(item.id, idx)"></button>
      </ng-template>
    </p-card>
  </div>
  }
</div> -->


<p-table [value]="products()" dataKey="id">
  <ng-template pTemplate="header">
    <tr>
      <th>عنوان</th>
      <th>دسته</th>
      <th>قیمت</th>
      <th>موجودی</th>
      <th>وضعیت</th>
      <th>عملیات</th>
    </tr>
  </ng-template>

  <ng-template pTemplate="body" let-product>
    <tr>
      <td>{{product.title}}</td>
      <td>{{product.categoryName}}</td>
      <td>{{product.price}}</td>
      <td>{{product.stock}}</td>
      <td>
        <p-tag [value]="product.condition"
               [severity]="product.condition === 'new' ? 'success' : 'warning'">
        </p-tag>
      </td>
      <td class="p-d-flex p-gap-2">
        <button pButton label="حذف" class="p-button-danger"
                (click)="deleteProduct(product.id)">
        </button>

        <button pButton label="ویرایش" class="p-button-warning" 
        (click)="editProduct(product)">
        </button>

        <button pButton label="جزئیات" class="p-button-info"
                (click)="toggleExpanded(product.id)">
        </button>
      </td>
    </tr>

    <tr *ngIf="expanded() === product.id">
      <td colspan="6">
        <ul>
          <li *ngFor="let attr of product.attributeValues">
            {{attr.attributeName}}: {{attr.value}}
          </li>
        </ul>
      </td>
    </tr>
  </ng-template>
</p-table>


<!--     PRODUCT HTML 
<form [formGroup]="productForm" (ngSubmit)="onSubmit()" class="form-container">
  <div class="form-group">
    <label for="title">عنوان محصول</label>
    <input pInputText id="title" formControlName="title" placeholder="عنوان محصول" />
    @if (productForm.get('title')?.touched && productForm.get('title')?.invalid) {
    <span class="error">عنوان اجباری است</span>
    }
  </div>
  <div class="form-group">
    <label for="description">توضیحات</label>
    <textarea pInputTextarea id="description" formControlName="description" class="form-textarea"
      placeholder="توضیحات"></textarea>
  </div>
  <div class="form-group">
    <label for="price">قیمت</label>
    <p-inputNumber id="price" formControlName="price" mode="decimal"></p-inputNumber>
    @if (productForm.get('price')?.touched && productForm.get('price')?.invalid) {
    <span class="error">قیمت باید عدد مثبت باشد</span>
    }
  </div>
  <div class="form-group">
    <label for="stock">موجودی</label>
    <p-inputNumber id="stock" formControlName="stock" [showButtons]="true" [min]="0"></p-inputNumber>
    @if (productForm.get('stock')?.touched && productForm.get('stock')?.invalid) {
    <span class="error">موجودی باید عدد غیرمنفی باشد</span>
    }
  </div>
  <div class="form-group">
    <label for="categoryId">دسته‌بندی</label>
    <p-select id="categoryId" formControlName="categoryId" [options]="mappedCategories()" optionLabel="name"
      optionValue="id" placeholder="انتخاب دسته" [showClear]="true"></p-select>
    @if (productForm.get('categoryId')?.touched && productForm.get('categoryId')?.invalid) {
    <span class="error">دسته‌بندی اجباری است</span>
    }
  </div>
  @if (categoryAttributes().length) {
  <div class="form-group">
    <label>ویژگی‌های دسته</label>
    @for (attr of categoryAttributes(); track attr; let i = $index) {
    <div class="attribute-input">
      <label for="attr-{{ i }}">{{ attr.attributeName }} {{ attr.required ? '*' : '' }}</label>
      @switch (attr.attributeType) {
      @case ('STRING') {
      <input pInputText id="attr-{{ i }}" [formControl]="getValueControl(i)"
        [placeholder]="'مقدار (مثل ' + (attr.attributeName === 'رنگ' ? 'قرمز' : 'متن') + ')'" />
      }
      @case ('NUMBER') {
      <p-inputNumber id="attr-{{ i }}" [formControl]="getValueControl(i)" [showButtons]="true" [min]="0"
        [placeholder]="'مقدار (مثل ' + (attr.attributeName === 'وزن' ? '۱.۵' : 'عدد') + ')'"></p-inputNumber>
      }
      @case ('BOOLEAN') {
      <div class="checkbox-group">
        <p-checkbox [formControl]="getValueControl(i)" binary="true" inputId="attr-{{ i }}"></p-checkbox>
        <label for="attr-{{ i }}">{{ attr.attributeName }}</label>
      </div>
      }
      @case ('SELECT') {
      <p-select id="attr-{{ i }}" [formControl]="getValueControl(i)"
        [options]="[{ label: 'گزینه ۱', value: 'گزینه ۱' }, { label: 'گزینه ۲', value: 'گزینه ۲' }]"
        placeholder="انتخاب مقدار"></p-select>
      }
      @case ('MULTISELECT') {
      <p-multiSelect id="attr-{{ i }}" [formControl]="getValueControl(i)"
        [options]="[{ label: 'گزینه ۱', value: 'گزینه ۱' }, { label: 'گزینه ۲', value: 'گزینه ۲' }]"
        placeholder="انتخاب مقادیر" [maxSelectedLabels]="2"></p-multiSelect>
      }
      }
      @if (getValueControl(i).touched && getValueControl(i).invalid) {
      <span class="error">{{ attr.attributeName }} اجباری است</span>
      }
    </div>
    }
  </div>
  }
  <button pButton type="submit" label="ثبت محصول" class="submit-btn" [disabled]="productForm.invalid"></button>
</form> -->



<!-- <div class="p-field">
  <label for="file">تصویر محصول</label>
  <input id="file" type="file" (change)="onFileBrowse($event)" class="p-inputtext p-component" />
</div> -->


    <!--  -->